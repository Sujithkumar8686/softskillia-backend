<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Soft Skilia â€“ Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600&display=swap"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      body {
        font-family: 'Work Sans', sans-serif;
      }
    </style>
  </head>
  <body class="bg-slate-50 min-h-screen flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
      <h2 class="text-2xl font-bold text-center text-[#0d141c] mb-6">
        Log in to your account
      </h2>

      <!-- Username -->
      <div class="mb-4">
        <label class="block text-[#0d141c] text-base font-medium mb-2" for="username">Username or Email</label>
        <input
          id="username"
          type="text"
          placeholder="Enter your username or email"
          class="w-full px-4 py-3 border border-[#cedbe8] rounded-xl placeholder:text-[#49739c]"
        />
        <span id="usernameError" class="text-red-500 text-sm pt-1 hidden">
          Enter a valid username or email address.
        </span>
      </div>

      <!-- Password -->
      <div class="mb-4 relative">
        <label class="block text-[#0d141c] text-base font-medium mb-2" for="password">Password</label>
        <input
          id="password"
          type="password"
          placeholder="Enter your password"
          class="w-full px-4 py-3 border border-[#cedbe8] rounded-xl placeholder:text-[#49739c]"
        />
        <button
          type="button"
          onclick="togglePassword()"
          class="absolute right-4 top-[46px] text-blue-600 text-lg"
        >
          <i id="toggleIcon" class="fas fa-eye"></i>
        </button>
        <span id="passwordError" class="text-red-500 text-sm pt-1 hidden">
          Password must be at least 6 characters.
        </span>
      </div>

      <!-- Remember Me -->
      <div class="flex items-center gap-2 mb-4">
        <input type="checkbox" id="rememberMe" />
        <label for="rememberMe" class="text-[#0d141c] text-base font-normal cursor-pointer">
          Remember Me
        </label>
      </div>

      <!-- Proceed Button -->
      <div class="mb-4">
        <button onclick="loginUser()">Proceed</button>
      </div>

      <!-- OR Separator -->
      <div class="relative my-4">
        <hr class="border-gray-300" />
        <span class="absolute top-[-12px] left-1/2 transform -translate-x-1/2 bg-white px-2 text-gray-500 text-sm">
          OR
        </span>
      </div>

      <!-- Google Login Button -->
      <div class="mb-4">
        <button class="w-full flex items-center justify-center gap-3 py-2 border border-[#cedbe8] rounded-xl hover:bg-gray-100 transition bg-white">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/512px-Google_%22G%22_Logo.svg.png" alt="Google logo" class="h-5 w-5" />
          <span class="text-sm font-medium text-[#0d141c]">Continue with Google</span>
        </button>
      </div>

      <!-- Register -->
      <p class="text-center text-sm text-[#49739c] mt-5">
        New to Soft Skilia?
        <a href="register.html" class="text-[#0a65c1] font-medium hover:underline">Register</a>
      </p>
    </div>

    <script>
      function togglePassword() {
        const passwordInput = document.getElementById("password");
        const icon = document.getElementById("toggleIcon");

        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        } else {
          passwordInput.type = "password";
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        }
      }

      window.onload = function () {
        const savedUsername = localStorage.getItem("savedUsername");
        if (savedUsername) {
          document.getElementById("username").value = savedUsername;
          document.getElementById("rememberMe").checked = true;
        }
      };

      function validateLogin() {
        const usernameInput = document.getElementById("username");
        const passwordInput = document.getElementById("password");
        const rememberMeCheckbox = document.getElementById("rememberMe");

        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        const usernameError = document.getElementById("usernameError");
        const passwordError = document.getElementById("passwordError");

        let valid = true;

        const usernameRegex = /^[a-zA-Z0-9._]{3,30}$/;
        const emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;

        if (!(emailRegex.test(username) || usernameRegex.test(username))) {
          usernameError.classList.remove("hidden");
          valid = false;
        } else {
          usernameError.classList.add("hidden");
        }

        if (password.length < 6) {
          passwordError.classList.remove("hidden");
          valid = false;
        } else {
          passwordError.classList.add("hidden");
        }

        if (!valid) return;

        fakeBackendLogin(username, password)
          .then((response) => {
            if (response.success) {
              if (rememberMeCheckbox.checked) {
                localStorage.setItem("savedUsername", username);
              } else {
                localStorage.removeItem("savedUsername");
              }
              window.location.href = "dashboard.html";
            } else {
              alert("Incorrect username or password. Please try again.");
            }
          })
          .catch((error) => {
            console.error("Login failed:", error);
            alert("Login failed due to server error. Please try again later.");
          });
      }

      function fakeBackendLogin(username, password) {
        return new Promise((resolve) => {
          setTimeout(() => {
            if (
              (username === "user@example.com" || username === "user") &&
              password === "password123"
            ) {
              resolve({ success: true });
            } else {
              resolve({ success: false });
            }
          }, 500);
        });
      }
    </script>
    <script>
      async function loginUser() {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;

        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ username, password })
        });

        const data = await res.json();
        if (data.success) {
          window.location.href = "home.html";
        } else {
          alert(data.message || "Login failed");
        }
      }
    </script>
  </body>
</html>
